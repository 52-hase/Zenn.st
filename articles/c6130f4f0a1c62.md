---
title: "LaravelとPHPでアプリを作成する"
emoji: "🌱"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [Laravel, PHP, Docker]
published: false
---
### 開発環境
- macOS
- VSCode
- Laravel
- PHP
- MySQL
- NGINX
##### ・作成された`default.conf`ファイルにコードを記載する
```php: default.conf
server {
    listen 80;

    root /var/www/laravel-app/public;  
    index index.php;  

    location / {
        root /var/www/laravel-app/public;
        index index.php;

        try_files $uri $uri/ /index.php$query_string;
    }

    location ~ .php$ {
        try_files $uri =404;

        fastcgi_split_path_info ^(.+.php)(/.+)$;

        fastcgi_pass app:9000;
        fastcgi_index index.php;

        include fastcgi_params;

        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; 
        fastcgi_param PATH_INFO $fastcgi_path_info;
    }
}
```

:::details コードの解説
```php: default.conf
server {  # サーバーブロック開始
    listen 80;  # HTTPリクエストのポート80番で待機

    root /var/www/laravel-app/public;  # ドキュメントルートをLaravel-appのpublicディレクトリに設定
    index index.php;  # デフォルトのインデックスファイルをindex.phpに設定

    location / {  # ルートパス（/）へのリクエスト処理
        root /var/www/laravel-app/public;  # ルートパスでもpublicディレクトリを参照
        index index.php;  # index.phpを優先的に探す

        try_files $uri $uri/ /index.php$query_string;  # リクエストされたファイルが存在すればそのまま返し、なければindex.phpにリダイレクト
    }

    location ~ .php$ {  # PHPファイルへのリクエスト処理
        try_files $uri =404;  # PHPファイルが存在しなければ404エラーを返す

        fastcgi_split_path_info ^(.+.php)(/.+)$;  # PHPファイルのパスを分割

        fastcgi_pass app:9000;  # PHP-FPMにリクエストを転送（コンテナ名 app を指定）
        fastcgi_index index.php;  # インデックスファイルをindex.phpに設定

        include fastcgi_params;  # FastCGIリクエストの基本パラメータをインクルード

        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;  # PHPスクリプトのフルパスを設定
        fastcgi_param PATH_INFO $fastcgi_path_info;  # PATH_INFOをPHPに渡す
    }
}
```
:::

<br>

---

<br>


##### ・`docker`ディレクトリの配下に`php`というディレクトリを作成する
```: ターミナル
$ mkdir php  # ディレクトリの作成

$ cd php  # ディレクトリへ移動
```
##### ・`php`ディレクトリの配下に`Dockerfile`を作成する（`Dockerコンテナ`の起動に使うファイル）
```: ターミナル
$ touch Dockerfile  # ファイルの作成
```
##### ・作成された`Dockerfile`にコードを記載する
```php: Dockerfile
FROM php:8.2-fpm
COPY php.ini /usr/local/etc/php/

RUN apt-get update \
  && apt-get install -y zlib1g-dev mariadb-client vim libzip-dev \
  && docker-php-ext-install zip pdo_mysql

#Composer install
RUN php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
RUN php composer-setup.php
RUN php -r "unlink('composer-setup.php');"
RUN mv composer.phar /usr/local/bin/composer

ENV COMPOSER_ALLOW_SUPERUSER 1

ENV COMPOSER_HOME /composer

ENV PATH $PATH:/composer/vendor/bin


WORKDIR /var/www

RUN composer global require "laravel/installer"
```
:::details コードの解説
```php: Dockerfile
# 使用するPHPのバージョンを指定。8.2-fpmはPHPのFastCGI Process Manager版を使用。
FROM php:8.2-fpm

# カスタムのphp.iniをコンテナ内にコピー
COPY php.ini /usr/local/etc/php/

# パッケージリストを更新し、必要なライブラリをインストール
RUN apt-get update \
  && apt-get install -y zlib1g-dev mariadb-client vim libzip-dev \
  && docker-php-ext-install zip pdo_mysql

# Composerをインストールするコマンド
# Composerのインストーラーをダウンロード
RUN php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"

# ダウンロードしたインストーラーを実行
RUN php composer-setup.php

# インストーラーを削除してきれいにする
RUN php -r "unlink('composer-setup.php');"

# composer.pharをシステム全体で使用できるように /usr/local/bin/composer に移動
RUN mv composer.phar /usr/local/bin/composer

# Composerの動作に関する環境変数を設定
ENV COMPOSER_ALLOW_SUPERUSER 1

# Composerのホームディレクトリを設定
ENV COMPOSER_HOME /composer

# コンテナ内でComposerの実行パスを追加
ENV PATH $PATH:/composer/vendor/bin

# 作業ディレクトリを指定 (コンテナ内での作業場所)
WORKDIR /var/www

# Laravelインストーラーをグローバルにインストール
RUN composer global require "laravel/installer"
```
:::

<br>

---

<br>


##### ・`php`ディレクトリの配下に`php.ini`ファイルを作成する（`PHPの設定`をするファイル）
```: ターミナル
$ touch php.ini  # ファイルの作成
```


##### ・作成された`php.ini`ファイルにコードを記載する
```php: php.ini
[Date]
date.timezone = "Asia/Tokyo"
[mbstring]
mbstring.internal_encoding = "UTF-8"
mbstring.language = "Japanese"
[opcache]
opcache.memory_consumption=128
opcache.interned_strings_buffer=8
opcache.max_accelerated_files=4000
opcache.revalidate_freq=60
opcache.fast_shutdown=1
opcache.enable_cli=1
```


:::details コードの解説
```php: php.ini
[Date]
date.timezone = "Asia/Tokyo"  # PHPのデフォルトタイムゾーンを「Asia/Tokyo」に設定

[mbstring]
mbstring.internal_encoding = "UTF-8"  # mbstringの内部エンコーディングをUTF-8に設定
mbstring.language = "Japanese"  # mbstringの使用する言語を日本語に設定

[opcache]
opcache.memory_consumption = 128  # OPCacheのメモリ消費量を128MBに設定
opcache.interned_strings_buffer = 8  # OPCacheの内部文字列バッファサイズを8MBに設定
opcache.max_accelerated_files = 4000  # 最大のアクセラレートファイル数を4000に設定
opcache.revalidate_freq = 60  # ファイル変更の再確認頻度を60秒に設定
opcache.fast_shutdown = 1  # OPCacheのシャットダウン時に最適化を行う設定
opcache.enable_cli = 1  # CLIでもOPCacheを有効にする
```
:::

<br>
- 
<br>
<br>
<br>

# 


::::details 

'''


'''

::::

<br>
<br>
<br>