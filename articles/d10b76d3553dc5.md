---
title: "Dockerについての基礎学習"
emoji: "📚"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [Docker]
published: true
---


### 行いたいこと
- Dockerの基本概念から応用技術まで全体像を理解する


<br>
<br>
<br>



# Dockerの基本概念

### Dockerとは
- Docker社が提供する`コンテナ型仮想化技術`。
- ゲストOSを起動せず、`Docker Engine`上でコンテナを動かすため、従来の仮想化より軽量。

### Dockerのメリット
- 複数開発者間での環境共有が容易。
- 軽量な動作で環境をどのマシン（PC）にも再現可能。
- 複雑なシステム構成（アーキテクチャ）でも効率的に共有できる。

:::details ここでのアーキテクチャとは？
・ここで言う「アーキテクチャ」は、システムやアプリケーションの構造や設計思想を指す
:::

# Docker Engineの構成要素

## ① Docker Engine
- Dockerを利用するための常駐プログラム。
- `「Docker for Mac」「Docker for Windows」`などをインストールして利用。

## ② イメージ（Image）
- コンテナを起動するための設定ファイルをまとめたもの。
- `tag`でバージョン管理（例：`nginx:latest`）。
- レイヤー構造で読み取り専用。

## ③ コンテナ（Container）
- イメージから起動されるアプリケーションの実行環境。
- 主な操作コマンド
・ `create`, `start`, `stop`, `restart`
・ `pause`, `unpause`, `rm`
・ コンテナ接続は `attach` や `exec` を利用。

## ④ Docker Hub（Container Registry）
- `Dockerイメージ`を共有するためのサービス。
- `GitHub`のようにリポジトリを作成して`push` / `pull`可能。
- 利用にはアカウント作成とログインが必要。


# データ管理・ネットワーク・Docker Compose

## ⑤ Dockerにおけるデータ管理

#### コンテナレイヤーのデメリット
- コンテナ削除時にデータが消える。
- コンテナ間でデータ共有不可。
- ユニオンファイルシステムのため書き込み速度が遅い。

#### データマウント手法（3種類）

1. **Volume**
   - ホスト上の`/var/lib/docker/volumes`をコンテナにマウント。
   - `docker volume create`で作成し、`--mount`で指定。
   - 複数コンテナ間でファイル共有が可能。

2. **Bind Mount**
   - ホスト上の任意ディレクトリをコンテナにマウント。
   - ホストから直接操作可能で設定不要。
   - 空ディレクトリをマウントするとデータ消失の恐れあり。

3. **tmpfs**
   - ホストのメモリ領域をコンテナにマウント。
   - ホストやコンテナ終了時にデータが自動的に解放。
   - メモリサイズの制限が設定可能。



## ⑥ Dockerネットワーク

#### ネットワークの目的
- 複数コンテナ間での通信を実現。
- 例：APIサーバとMySQLコンテナの通信。

#### デフォルトネットワーク（3種類）
- **Bridge**（デフォルト）
  - コンテナ同士はIP指定で通信可能。
  - コンテナ名で通信する場合は独自ネットワーク作成が必要。
- **Host**
  - Dockerホストと同じネットワークを利用。
  - ポート設定不要。
- **None**
  - 完全にネットワークから切り離す設定。

#### 独自ネットワーク
- `docker network create`で作成。
- 組み込みDNSによりコンテナ名で通信可能。



## ⑦ Docker Compose

#### 目的
- 複数コンテナの設定をまとめて管理・実行するツール。
- 環境構築を効率化し、共有を容易にする。

#### 使用手順
1. `Dockerfile`または`Docker Hubイメージ`を準備。
2. `docker-compose.yml`を定義。
3. `docker-compose up`で起動。

#### メリット
- 単一のymlファイルで複数コンテナを管理。
- 環境設定を簡単に共有可能。

#### 主なコマンド
- `docker-compose up`：起動
- `docker-compose down`：削除
- `docker-compose ps`：一覧表示
- `docker-compose run`：コマンド実行

#### 実装例：Djangoアプリ
- `Dockerfile`でPythonとDjango環境を定義。
- `docker-compose.yml`でwebサーバとdbサーバを設定。
- `depends_on`で起動順序を制御。



# Docker Machine・Docker Swarm

## ⑧ Docker Machine

#### 概要
- `Docker Engine`を搭載した仮想マシンを管理するCLIツール。
- `VirtualBox`などの仮想化ソフトを利用。
- ローカル・リモート両方の`Dockerホスト`を管理可能。

#### 主なコマンド
- `docker-machine ls`：ホスト一覧表示
- `docker-machine create`：新規ホスト作成
- `docker-machine start/stop`：起動・停止
- `docker-machine ssh`：ホストへSSH接続

#### クラウド対応
- `AWS`や`GCP`に`Dockerホスト`を作成・管理可能。



## ⑨ Docker Swarm

#### 概要
- `複数Dockerホストを統合管理`するためのオーケストレーションツール。
- `Kubernetes`と同様にクラスタ管理機能を提供。

#### 基本概念
- `Workerノード`：コンテナ実行専用。
- `Managerノード`：クラスタ管理＋コンテナ実行。
- `Overlayネットワーク`：ノード間通信を自動設定。

#### 主な機能
1. **ServiceとTask管理**
   - `Service`：コンテナの数や実行場所を定義。
   - `Task`：実際に動作するコンテナ。
2. **ローリングアップデート**
   - 遅延設定をして順次更新。
3. **オートスケーリング**
   - 負荷に応じて自動でコンテナ数を調整。
4. **Auto Healing**
   - ノード障害時にコンテナを自動復旧。

#### 主なコマンド
- `docker swarm init`：Swarmクラスタ作成
- `docker node ls`：ノード一覧表示
- `docker service create`：サービス作成
- `docker service scale`：コンテナ数スケーリング




<br>
<br>


### 以上です。

<br>
<br>
<br>

