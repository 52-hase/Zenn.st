---
title: "SPFについての覚書"
emoji: "📚"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [SPF]
published: false
---

### 行いたいこと
- SPFについての覚書をしていく

<br>
<br>

# SPFとは
- `SPF（Sender Policy Framework）`は、メールの送信者が本物かどうかを確認する仕組み。`DNSサーバー`にメール送信を許可するサーバー情報を登録することで、`「なりすましメール」`ではないことを証明する。

- メールマーケティングや業務メールを確実に届けるには、`SPF`と`DKIM`の両方を適切に設定することが現代では必須です。

- 大量配信を行う場合は、これらの技術に対応したメール配信サービスの利用を検討することが重要になる。

# SPFが重要な理由
- 設定しないとどうなる？
・なりすましメールと判定されやすい
・迷惑メールフォルダに入りやすい
・最悪、メールが相手に届かない
・利用しているIPアドレスの“信頼スコア”が下がる

特に`Gmail・Yahoo・Outlook（Microsoft）`は、
SPF未設定のドメインから送られたメールを非常に厳しく扱われる。

# 特に注意が必要なケース
・メール配信サービス利用時、クラウド型のメール配信サービスでは、送信元ドメインと実際の配信サーバーが異なるため、SPF設定が必須となる。

# SPFだけでは不十分
- `DKIM署名`も重要
・メール内容の改ざんを防ぐ技術
・`SPF`と`DKIM`両方を設定することで、メールの信頼性が大幅に向上する
・Gmailでは2024年2月から、大量送信者（1日5,000件以上）に`SPF・DKIM・DMARC`の設定を義務化

# 実践的な対応策
- メール配信システムの選択
・`SPF・DKIM`両方に対応したサービスを選ぶ
・専門的な設定や管理をサービス側に任せられる
・高い到達率と安定した配信が期待できる


① SPFレコードの具体例
例：
```
v=spf1 include:spf.protection.outlook.com ~all
```

それぞれの記述の意味（include / ip4 / a / mx / ~all / -all）

② SPFの評価ロジック（仕組み）
SPFとは「DNSに送信可能なサーバーを登録するもの」と表現していますが、
・メール受信サーバーは送信元 IP を参照
・ドメインの SPF レコードと照合
・合致すれば OK、違えば SoftFail など
この流れを軽く図か bullet で書くとわかりやすい

③ ~all（SoftFail）と -all（Fail）の違いを説明
SPF を設定するうえで最もつまずきやすいポイントです。
・運用の場では以下が重要になる
・~all：まずはこれを使う（誤判定を防ぐ）
・-all：確実に SPF を限定したいときに使う

④ SPF の弱点を補足すると深みが出る
「SPF だけでは不十分」
・SPF はメール転送（Forward）に弱い
・転送されると SPF が失敗する可能性がある
・だから DKIM と DMARC も必要になる
この説明があると、SPF の位置づけが明確になる








<br>
<br>


### 以上です。

<br>
<br>
<br>