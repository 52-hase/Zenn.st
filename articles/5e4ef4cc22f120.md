---
title: "アーキテクチャについて"
emoji: "🙌"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [アーキテクチャ]
published: false
---






[![Image from Gyazo](https://i.gyazo.com/2d42d30ec5605e5428f0312e6811345b.png)](https://gyazo.com/2d42d30ec5605e5428f0312e6811345b)



全体構成
Ruby on Rails を中心とした モノリシック構成のWebアプリケーション
ユーザーは ブラウザ（PC / スマホ） からアクセス
本番環境は Heroku、ファイル保存は AWS S3
リアルタイム機能は ActionCable（WebSocket） を使用

クライアント（ユーザー）
ブラウザからアプリにアクセス
HTTP / HTTPS および WebSocket でサーバーと通信
操作内容（投稿、チャットなど）をフロントエンドへ送信


### フロントエンド
- JavaScript
画面の動的更新（非同期通信 / Ajax）
ユーザー操作に応じた即時UI更新
- Bootstrap
レスポンシブ対応のUIコンポーネント
デザインの統一・実装工数の削減
- RailsのViewと組み合わせて表示を制御

### バックエンド（Heroku上）
- Ruby 3.2.2 + Ruby on Rails 7.1.3
アプリケーションの中核
MVCアーキテクチャを採用
- Controller
リクエストの受付
モデル・外部APIとの連携
- Model（ActiveRecord）
データベース操作
バリデーション・ビジネスロジック管理
- View
フロントエンドへレスポンスを返却

### リアルタイム通信
- WebSocket（ActionCable）
チャットなどのリアルタイム機能を実現
クライアントと双方向通信
ページ更新なしでデータ反映

### データベース
- PostgreSQL
ユーザー情報、投稿データ、音楽データを永続化
ActiveRecord を通じて操作
- Heroku Postgres として運用

### ファイルストレージ
- Active Storage
Rails標準のファイル管理機構
- AWS S3
画像・アップロードファイルの保存先
アプリサーバーとストレージを分離し、拡張性を確保

### 外部API連携
- Spotify Web API（gem rspotify）
楽曲・アーティスト情報の取得
検索・表示機能としてアプリ内で利用
- Rails から外部APIへリクエストを送信

### 開発環境
- Docker
Rails / PostgreSQL / Node.js をコンテナ化
開発環境の統一・再現性を確保
チーム開発や環境構築を容易にする



```

ユーザー操作
→ JavaScript
→ ActionCable（WebSocket）
→ Rails（Controller / Model）
→ PostgreSQL
→ ActionCable
→ 他ユーザーの画面に即時反映

ユーザー操作
  ↓
JavaScript（送信イベント）
  ↓
ActionCable（WebSocket）
  ↓
Rails Channel
  ↓
ActiveRecord（Message保存）
  ↓
PostgreSQL
  ↓
ActionCable（ブロードキャスト）
  ↓
JavaScript（DOM更新）
  ↓
全ユーザーの画面に即時表示

```

① ユーザーがチャットを入力・送信（フロントエンド）
ユーザーがチャット入力欄にメッセージを入力
「送信」ボタンをクリック
使用技術
Rails View　チャット画面のHTMLを描画
Bootstrap　入力フォームやボタンのUIを整える
JavaScript　送信イベントを検知、ページ遷移せず処理を実行

② JavaScriptがWebSocket通信を開始
JavaScriptが ActionCableのChannel に接続
入力されたメッセージを WebSocket経由 で送信
ポイント
通常のHTTP（Ajax）ではなく、WebSocket（常時接続）を使用、ページ更新は発生しない

③ ActionCable（Rails）がメッセージを受信
Rails側の Channelクラス がメッセージを受け取る
「どのチャットルームか」「誰が送ったか」を識別

使用技術
ActionCable　クライアントとサーバーの双方向通信、Heroku上で常時接続を維持


④ Model（ActiveRecord）でDBに保存
Channel内で Messageモデル を作成
バリデーションを通過後、DBへ保存

使用技術
ActiveRecord　メッセージ内容・ユーザーID・ルームIDを保存
PostgreSQL（Heroku Postgres）　チャットデータを永続化
ここで行われること　空メッセージの防止、ユーザーとチャットルームの紐付け

⑤ 保存成功後、ActionCableでブロードキャスト
保存されたメッセージを同じチャットルームに接続中の全ユーザーへ送信
ポイント
サーバー → 複数クライアントへ同時配信、HTTPレスポンスは使わない

⑥ 各ユーザーの画面が即時更新（フロントエンド）
JavaScriptが受信したメッセージを検知、チャット一覧にHTMLを動的に追加

使用技術
JavaScript　DOM操作でメッセージを追加
Bootstrap　吹き出し・レイアウトを統一
結果
送信者・受信者 両方の画面に即時反映、ページ更新なしでリアルタイム表示


⑦（補足）画像付きメッセージの場合
画像は Active Storage を通してアップロード、ファイル本体は AWS S3 に保存、DBにはファイルの参照情報のみ保存、チャットには S3のURL を表示