---
title: "Laravelã¨PHPã§ã‚¢ãƒ—ãƒªä½œæˆ"
emoji: "ğŸ“š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Laravel, ]
published: false
---
### é–‹ç™ºç’°å¢ƒ
- macOS
- VSCode
- Laravel
- PHP
- MySQL
- NGINX

### è¡Œã„ãŸã„ã“ã¨
- Laravelã¨PHPã§ã‚¢ãƒ—ãƒªã®ä½œæˆ


<br>
<br>
<br>

# Laravelã®é–‹ç™ºç’°å¢ƒã‚’Dockerã§æ§‹ç¯‰ã™ã‚‹æ‰‹é †
### ãƒ»Laravelé–‹ç™ºç’°å¢ƒã‚’ã—ã¦ã„ããƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ â‡¨ ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«ã¸ç§»å‹•
```: ã‚¿ãƒ¼ãƒŸãƒŠãƒ«
$ mkdir Laravel_appã€€ã€€# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ

$ cd Laravel_appã€€ # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ç§»å‹•
```
<br>

â€» ä½œæˆã—ãŸ`Laravel_app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®é…ä¸‹ã«ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹
[![Image from Gyazo](https://i.gyazo.com/e995ea39180a6e8c26602bab4766c273.png =600x)](https://gyazo.com/e995ea39180a6e8c26602bab4766c273)

<br>

### ãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆæ‰‹é †ã¨è¨˜è¼‰ã‚³ãƒ¼ãƒ‰
ãƒ»`docker`ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€ãã®é…ä¸‹ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã„ã
```: ã‚¿ãƒ¼ãƒŸãƒŠãƒ«
$ mkdir docker  # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ

$ cd docker  # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ç§»å‹•
```
ãƒ»`docker`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®é…ä¸‹ã«`nginx`ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹
```: ã‚¿ãƒ¼ãƒŸãƒŠãƒ«
$ mkdir nginx  # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ

$ cd nginx  # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ç§»å‹•
```
ãƒ»`php`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®é…ä¸‹ã«`default.conf`ã‚’ä½œæˆã™ã‚‹ï¼ˆ`nginxã®è¨­å®š`ã‚’ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
```: ã‚¿ãƒ¼ãƒŸãƒŠãƒ«
$ touch default.conf  # ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
```
ãƒ»ä½œæˆã•ã‚ŒãŸ`default.conf`ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¼‰ã™ã‚‹
```php: default.conf
server {
    listen 80;

    root /var/www/laravel-project/public;  
    index index.php;  

    location / {
        root /var/www/laravel-project/public;
        index index.php;

        try_files $uri $uri/ /index.php$query_string;
    }

    location ~ .php$ {
        try_files $uri =404;

        fastcgi_split_path_info ^(.+.php)(/.+)$;

        fastcgi_pass app:9000;
        fastcgi_index index.php;

        include fastcgi_params;

        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; 
        fastcgi_param PATH_INFO $fastcgi_path_info;
    }
}
```
:::details ã‚³ãƒ¼ãƒ‰ã®è§£èª¬
```
server {  # ã‚µãƒ¼ãƒãƒ¼ãƒ–ãƒ­ãƒƒã‚¯é–‹å§‹
    listen 80;  # HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒ¼ãƒˆ80ç•ªã§å¾…æ©Ÿ

    root /var/www/laravel-project/public;  # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ«ãƒ¼ãƒˆã‚’Laravelãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®publicãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«è¨­å®š
    index index.php;  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’index.phpã«è¨­å®š

    location / {  # ãƒ«ãƒ¼ãƒˆãƒ‘ã‚¹ï¼ˆ/ï¼‰ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†
        root /var/www/laravel-project/public;  # ãƒ«ãƒ¼ãƒˆãƒ‘ã‚¹ã§ã‚‚publicãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å‚ç…§
        index index.php;  # index.phpã‚’å„ªå…ˆçš„ã«æ¢ã™

        try_files $uri $uri/ /index.php$query_string;  # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚Œã°ãã®ã¾ã¾è¿”ã—ã€ãªã‘ã‚Œã°index.phpã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    }

    location ~ .php$ {  # PHPãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†
        try_files $uri =404;  # PHPãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã‘ã‚Œã°404ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™

        fastcgi_split_path_info ^(.+.php)(/.+)$;  # PHPãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’åˆ†å‰²

        fastcgi_pass app:9000;  # PHP-FPMã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è»¢é€ï¼ˆã‚³ãƒ³ãƒ†ãƒŠå app ã‚’æŒ‡å®šï¼‰
        fastcgi_index index.php;  # ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’index.phpã«è¨­å®š

        include fastcgi_params;  # FastCGIãƒªã‚¯ã‚¨ã‚¹ãƒˆã®åŸºæœ¬ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰

        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;  # PHPã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ•ãƒ«ãƒ‘ã‚¹ã‚’è¨­å®š
        fastcgi_param PATH_INFO $fastcgi_path_info;  # PATH_INFOã‚’PHPã«æ¸¡ã™
    }
}
```
:::

<br>
<br>


ãƒ»`docker`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®é…ä¸‹ã«`php`ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹
```: ã‚¿ãƒ¼ãƒŸãƒŠãƒ«
$ mkdir php  # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ

$ cd php  # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ç§»å‹•
```
ãƒ»`php`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®é…ä¸‹ã«`Dockerfile`ã‚’ä½œæˆã™ã‚‹ï¼ˆ`Dockerã‚³ãƒ³ãƒ†ãƒŠ`ã®èµ·å‹•ã«ä½¿ã†ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
```: ã‚¿ãƒ¼ãƒŸãƒŠãƒ«
$ touch Dockerfile  # ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
```
ãƒ»ä½œæˆã•ã‚ŒãŸ`Dockerfile`ã«ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¼‰ã™ã‚‹
```php: Dockerfile
FROM php:8.2-fpm
COPY php.ini /usr/local/etc/php/

RUN apt-get update \
  && apt-get install -y zlib1g-dev mariadb-client vim libzip-dev \
  && docker-php-ext-install zip pdo_mysql

#Composer install
RUN php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
RUN php composer-setup.php
RUN php -r "unlink('composer-setup.php');"
RUN mv composer.phar /usr/local/bin/composer

ENV COMPOSER_ALLOW_SUPERUSER 1

ENV COMPOSER_HOME /composer

ENV PATH $PATH:/composer/vendor/bin


WORKDIR /var/www

RUN composer global require "laravel/installer"
```
:::details ã‚³ãƒ¼ãƒ‰ã®è§£èª¬
```php: Dockerfile
# ä½¿ç”¨ã™ã‚‹PHPã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã€‚8.2-fpmã¯PHPã®FastCGI Process Managerç‰ˆã‚’ä½¿ç”¨ã€‚
FROM php:8.2-fpm

# ã‚«ã‚¹ã‚¿ãƒ ã®php.iniã‚’ã‚³ãƒ³ãƒ†ãƒŠå†…ã«ã‚³ãƒ”ãƒ¼
COPY php.ini /usr/local/etc/php/

# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒªã‚¹ãƒˆã‚’æ›´æ–°ã—ã€å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN apt-get update \
  && apt-get install -y zlib1g-dev mariadb-client vim libzip-dev \
  && docker-php-ext-install zip pdo_mysql

# Composerã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰
# Composerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
RUN php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"

# ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’å®Ÿè¡Œ
RUN php composer-setup.php

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’å‰Šé™¤ã—ã¦ãã‚Œã„ã«ã™ã‚‹
RUN php -r "unlink('composer-setup.php');"

# composer.pharã‚’ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã§ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã« /usr/local/bin/composer ã«ç§»å‹•
RUN mv composer.phar /usr/local/bin/composer

# Composerã®å‹•ä½œã«é–¢ã™ã‚‹ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
ENV COMPOSER_ALLOW_SUPERUSER 1

# Composerã®ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¨­å®š
ENV COMPOSER_HOME /composer

# ã‚³ãƒ³ãƒ†ãƒŠå†…ã§Composerã®å®Ÿè¡Œãƒ‘ã‚¹ã‚’è¿½åŠ 
ENV PATH $PATH:/composer/vendor/bin

# ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®š (ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã®ä½œæ¥­å ´æ‰€)
WORKDIR /var/www

# Laravelã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN composer global require "laravel/installer"
```
:::

<br>

ãƒ»`php`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®é…ä¸‹ã«`php.ini`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ˆ`PHPã®è¨­å®š`ã‚’ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
```: ã‚¿ãƒ¼ãƒŸãƒŠãƒ«
$ touch php.ini  # ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
```
ãƒ»ä½œæˆã•ã‚ŒãŸ`php.ini`ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¼‰ã™ã‚‹
```php: php.ini
[Date]
date.timezone = "Asia/Tokyo"
[mbstring]
mbstring.internal_encoding = "UTF-8"
mbstring.language = "Japanese"
[opcache]
opcache.memory_consumption=128
opcache.interned_strings_buffer=8
opcache.max_accelerated_files=4000
opcache.revalidate_freq=60
opcache.fast_shutdown=1
opcache.enable_cli=1
```

:::details ã‚³ãƒ¼ãƒ‰ã®è§£èª¬
```php: php.ini
[Date]
date.timezone = "Asia/Tokyo"  # PHPã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’ã€ŒAsia/Tokyoã€ã«è¨­å®š

[mbstring]
mbstring.internal_encoding = "UTF-8"  # mbstringã®å†…éƒ¨ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’UTF-8ã«è¨­å®š
mbstring.language = "Japanese"  # mbstringã®ä½¿ç”¨ã™ã‚‹è¨€èªã‚’æ—¥æœ¬èªã«è¨­å®š

[opcache]
opcache.memory_consumption = 128  # OPCacheã®ãƒ¡ãƒ¢ãƒªæ¶ˆè²»é‡ã‚’128MBã«è¨­å®š
opcache.interned_strings_buffer = 8  # OPCacheã®å†…éƒ¨æ–‡å­—åˆ—ãƒãƒƒãƒ•ã‚¡ã‚µã‚¤ã‚ºã‚’8MBã«è¨­å®š
opcache.max_accelerated_files = 4000  # æœ€å¤§ã®ã‚¢ã‚¯ã‚»ãƒ©ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ•°ã‚’4000ã«è¨­å®š
opcache.revalidate_freq = 60  # ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã®å†ç¢ºèªé »åº¦ã‚’60ç§’ã«è¨­å®š
opcache.fast_shutdown = 1  # OPCacheã®ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³æ™‚ã«æœ€é©åŒ–ã‚’è¡Œã†è¨­å®š
opcache.enable_cli = 1  # CLIã§ã‚‚OPCacheã‚’æœ‰åŠ¹ã«ã™ã‚‹
```
:::

<br>





[![Image from Gyazo](https://i.gyazo.com/82d1bfce044c39d1e24af189180d80d0.png)](https://gyazo.com/82d1bfce044c39d1e24af189180d80d0)

<br>
<br>
<br>

